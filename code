-- 월급과 직무 만족도, 나이에 따른 이탈률
SELECT
  CASE
    WHEN MonthlyIncome < 5000 THEN '5000미만'
    WHEN MonthlyIncome BETWEEN 5000 AND 9999 THEN '5000~9999'
    WHEN MonthlyIncome BETWEEN 10000 AND 14999 THEN '10000~14999'
    ELSE '15000이상'
  END AS salary_band,
  JobSatisfaction,
  CASE
    WHEN Age < 20 THEN '10대'
    WHEN Age BETWEEN 20 AND 29 THEN '20대'
    WHEN Age BETWEEN 30 AND 39 THEN '30대'
    WHEN Age BETWEEN 40 AND 49 THEN '40대'
    ELSE '50대'
  END AS age_band,
  COUNT(*) AS total_employees,
  SUM(Attrition = 'Yes') AS leavers,
  ROUND(AVG(Attrition = 'Yes') * 100, 2) AS attrition_rate
FROM hr_employee
GROUP BY salary_band, JobSatisfaction, age_band
ORDER BY JobSatisfaction, age_band;


-- 초과근무 여부와 직무 만족도에 따른 이탈률
SELECT
  OverTime,
  JobSatisfaction,
  COUNT(*) AS total_employees,
  SUM(Attrition = 'Yes') AS leavers,
  ROUND(AVG(Attrition = 'Yes') * 100, 2) AS attrition_rate
FROM hr_employee
WHERE OverTime IS NOT NULL
  AND JobSatisfaction IS NOT NULL
GROUP BY OverTime, JobSatisfaction
ORDER BY JobSatisfaction;


-- 직무에 따른 이탈률 
SELECT
  JobRole,
  COUNT(*) AS total_employees,
  SUM(Attrition = 'Yes') AS leavers,
  ROUND(AVG(Attrition = 'Yes') * 100, 2) AS attrition_rate
FROM hr_employee
WHERE JobRole IS NOT NULL
GROUP BY JobRole
ORDER BY attrition_rate DESC;


-- 초과근무를 하는 직원의 결혼 상태 및 출장빈도에 따른 이탈률 
SELECT
  MaritalStatus,
  BusinessTravel,
  COUNT(*) AS total_employees,
  SUM(Attrition = 'Yes') AS leavers,
  ROUND(AVG(Attrition = 'Yes') * 100, 2) AS attrition_rate
FROM hr_employee
WHERE OverTime = 'Yes'
  AND MaritalStatus IS NOT NULL
  AND BusinessTravel IS NOT NULL
GROUP BY MaritalStatus, BusinessTravel
ORDER BY MaritalStatus;


-- 초과근무를 하지 않는 직원들의 결혼 상태 및 출자인도에 따른 이탈률 
SELECT
  MaritalStatus,
  BusinessTravel,
  COUNT(*) AS total_employees,
  SUM(Attrition = 'Yes') AS leavers,
  ROUND(AVG(Attrition = 'Yes') * 100, 2) AS attrition_rate
FROM hr_employee
WHERE OverTime = 'No'
  AND MaritalStatus IS NOT NULL
  AND BusinessTravel IS NOT NULL
GROUP BY MaritalStatus, BusinessTravel
ORDER BY MaritalStatus;

